<script>
	function updateAlert(id) {
		$.ajax({ //Process the form using $.ajax()
			type        : 'POST', //Method type
			url         : '<?=$updateAlert?>', //Your form processing file url
			data        : $('#conditionTable').serialize(), 
			success     : function(msg) {
				console.log(msg);
				refresh();						
			}
		});
		event.preventDefault(); //Prevent the default submit      
	}
	
	function updateTrade(id) {
		console.log($('#tradeTable').serialize() );
		$.ajax({ //Process the form using $.ajax()
			type        : 'POST', //Method type
			url         : '<?=$updateTrade?>', //Your form processing file url
			data        : $('#tradeTable').serialize(), 
			success     : function(msg) {
				console.log(msg);
				refresh();						
			}
		});
		event.preventDefault(); //Prevent the default submit      
	}
	
	function fillFormAlert(id) {
		$.getJSON("<?=$readAlert?>&id="+id+"", function( data ) {
		
		$.each( data, function( key, val ) {
			if(data.hasOwnProperty(key))
				$('input[name='+key+']').val(val);

			if(key == 'currency') {						
				$('select[name="currency"]').find('option:contains("'+val+'")').attr("selected",true);	
			}
			
			if(key == 'on_condition') {					
				$('select[name="on_condition"]').find('option:contains("'+val+'")').attr("selected",true);	
			}
		
			if(key == 'unit') {
				$('select[name="unit"]').find('option:contains("'+val+'")').attr("selected",true);	
			}
			
			if(key == 'exchange' || key == 'sent') {
				$('select[name="'+key+'"]').find('option:contains("'+val+'")').attr("selected",true);	
			}
			
            });
        });
    }
	
	function fillFormTrade(id) {

	$.getJSON("<?=$readTrade?>&trade_id="+id+"", function( data ) {
		console.log('fillFormTrade: '+data);
		$.each( data, function( key, val ) {
			if(data.hasOwnProperty(key))
				$('input[name='+key+']').val(val);

			if(key == 'id') {
				$('input[name=trade_id]').val(val);
			}
			
			//select the values for drop down menus
			if(key == 'trade_currency' || key == 'trade_condition' || key == 'trade_exchange' || key == 'trade_action' || key == 'trade_unit') {
				$('select[name="'+key+'"]').find('option:contains("'+val+'")').attr("selected",true);		
			}
            });
        });
	}
    
    function deleteAlert(id) {
        if (confirm("Are you sure you want to delete record "+id+"?")) {
            $.ajax({
                type: "GET",
                url: "<?=$deleteAlert?>&id="+id,
                success: function() {
                    alert('Deleted record '+id);
                    location.reload();
                }
            })
        }    
    }
    
	function deleteTrade(id) {
        if (confirm("Are you sure you want to delete record "+id+"?")) {
            $.ajax({
                type: "GET",
                url: "<?=$deleteTrade?>&trade_id="+id,
                success: function() {
                    //alert('Deleted record '+id);
                    location.reload();
                }
            })
        }    
    }
	
    function createAlert() {
		$.ajax({
			type: "POST",
			url: "<?=$createAlert?>",
			data: $('#conditionTable').serialize(),
			success: function(msg) {
				console.log(msg);
				location.reload();
			}
		});
    }
	
	function createTrade() {
		$.ajax({
			type: "POST",
			url: "<?=$createTrade?>",
			data: $('#tradeTable').serialize(),
			success: function(msg) {
				console.log(msg);				
				location.reload();
			}
		});
    }

	function refresh() {
		location.reload();
	}
	
	function updateAlertDialog(id) {
	
		$("select[name=currency]").remove(); //remove  acct select menu
		$("#currencyDiv").html('<?=$currencyDropDown?>');	//re-construct the acct menu
			
		$("select[name=on_condition]").remove();	//remove on_condition select menu
		$("#conditionDiv").html('<?=$conditionDropDown?>');	//re-construct the on_condition men
		
		$("select[name=unit]").remove();	//remove unit select menu
		$("#unitDiv").html('<?=$unitDropDown?>');	//re-construct the unit menu
		
		$("select[name=exchange]").remove();	//remove exchange menu
		$("#exchangeDiv").html('<?=$exchangeDropDown?>');	//re-construct the exchange men

		$('select[name=sent]').remove();
		$('#sentDiv').html('<?=$sentDropDown?>');
			
		fillFormAlert(id);
	
		$( "#deleteAlert" ).click(function() {
			deleteAlert(id);
		});
		
		$("#conditionTable").dialog({
			modal: true,
			width: 790,
			position: 'top',
			show: {
				effect: "explode",
				duration: 500
			},
			hide: {
				effect: "explode",
				duration: 500
			},
			buttons: {
				Save: function () {
					updateAlert(id);
					$( this ).dialog( "close" );
				},
				Cancel: function() {
					refresh();
					$( this ).dialog( "close" );				
				},                        
			}
		});	
	}
	
	function updateTradeDialog(id) {

		$("select[name=trade_currency]").remove(); //remove  acct select menu
		$("#tradeCurrencyDiv").html('<?=$tradeCurrencyDropDown?>');	//re-construct the acct menu
			
		$("select[name=trade_condition]").remove();	//remove on_condition select menu
		$("#tradeConditionDiv").html('<?=$tradeConditionDropDown?>');	//re-construct the on_condition menu
		
		$("select[name=trade_exchange]").remove();	//remove exchange menu
		$("#tradeExchangeDiv").html('<?=$tradeExchangeDropDown?>');	//re-construct the exchange menu

		$("select[name=trade_action]").remove();	//remove action menu
		$("#tradeActionDiv").html('<?=$tradeActionDropDown?>');	//re-construct the action menu

		$("select[name=trade_unit]").remove();	//remove action menu
		$("#tradeUnitDiv").html('<?=$tradeUnitDropDown?>');	//re-construct the unit menu

		
		fillFormTrade(id);
	
		$( "#deleteTrade" ).click(function() {
			deleteTrade(id);
		});
		
		$("#tradeTable").dialog({
			modal: true,
			width: 790,
			position: 'top',
			show: {
				effect: "explode",
				duration: 500
			},
			hide: {
				effect: "explode",
				duration: 500
			},
			buttons: {
				Save: function () {
					updateTrade(id);
					$( this ).dialog( "close" );
				},
				Cancel: function() {
					refresh();
					$( this ).dialog( "close" );				
				},                        
			}
		});	
	}

    $(document).ready(function () {
		
		//hide pop up forms			
		$("#conditionTable").hide();
		$("#tradeTable").hide();		
		$("#accountBalance").hide();		
		
		$( "#until_date" ).datepicker();
							
		$(".createButton").click(function() {

			$("#conditionTable").dialog({
				modal: true,
				width: 790,
				position: 'top',
				show: {
					effect: "explode",
					duration: 500
				},
				hide: {
					effect: "explode",
					duration: 500
				},
				buttons: {
					Save: function() {
						createAlert();
						$(this).dialog("close");
					},
					Cancel: function() {
						$(this).dialog("close");
					}
				}
			})
		});
		
		$(".tradeButton").click(function() {
			$("#tradeTable").dialog({
				modal: true,
				width: 790,
				position: 'top',
				show: {
					effect: "explode",
					duration: 500
				},
				hide: {
					effect: "explode",
					duration: 500
				},
				buttons: {
					Save: function() {
						createTrade();
						$(this).dialog("close");
					},
					Cancel: function() {
						$(this).dialog("close");
					}
				}
			})
		});	
		
		$(".balanceButton").click(function() {
			$("#accountBalance").dialog({
				modal: true,
				width: 790,
				position: 'top',
				show: {
					effect: "explode",
					duration: 500
				},
				hide: {
					effect: "explode",
					duration: 500
				},
				buttons: {
					Save: function() {
						createTrade();
						$(this).dialog("close");
					},
					Cancel: function() {
						$(this).dialog("close");
					}
				}
			})
		});

		$('#priceTable').load('load.php?page=priceTable');		
		$('#cronSendAlerts').load('load.php?page=cronSendAlerts');		
		$('#btcTrades').load('load.php?page=btcTrades');		
		$('#cronAutoTrade').load('load.php?page=cronAutoTrade');		
		
    });
</script>