<script>
	function updateRow(id) {
		$.ajax({ //Process the form using $.ajax()
			type        : 'POST', //Method type
			url         : '<?=$update_call?>', //Your form processing file url
			data        : $('#conditionTable').serialize(), 
			success     : function(msg) {
				console.log(msg);
				refresh();						
			}
		});
		event.preventDefault(); //Prevent the default submit      
	}
    
	function fillForm(id) {
		
		$.getJSON("<?=$read_call?>&id="+id+"", function( data ) {
		
		$.each( data, function( key, val ) {
			if(data.hasOwnProperty(key))
				$('input[name='+key+']').val(val);

			if(key == 'currency') {						
				$('select[name="currency"]').find('option:contains("'+val+'")').attr("selected",true);	
			}
			
			if(key == 'on_condition') {					
				$('select[name="on_condition"]').find('option:contains("'+val+'")').attr("selected",true);	
			}
		
			if(key == 'unit') {
				$('select[name="unit"]').find('option:contains("'+val+'")').attr("selected",true);	
			}
			
			if(key == 'exchange' || key == 'sent') {
				$('select[name="'+key+'"]').find('option:contains("'+val+'")').attr("selected",true);	
			}
			
            });
        });
    }
    
    function deleteAlert(id) {
        if (confirm("Are you sure you want to delete record "+id+"?")) {
            $.ajax({
                type: "GET",
                url: "<?=$delete_call?>&id="+id,
                success: function() {
                    alert('Deleted record '+id);
                    location.reload();
                }
            })
        }    
    }
    
    function createRow() {
		$.ajax({
			type: "POST",
			url: "<?=$createAlert?>",
			data: $('#conditionTable').serialize(),
			success: function(msg) {
				console.log(msg);
				location.reload();
			}
		});
    }
	
	function createTrade() {
		$.ajax({
			type: "POST",
			url: "<?=$createTrade?>",
			data: $('#tradeTable').serialize(),
			success: function(msg) {
				console.log(msg);
				alert(msg);
				//location.reload();
			}
		});
    }

	function refresh() {
		location.reload();
	}
	
	function updateDialog(id) {
	
		$("select[name=currency]").remove(); //remove  acct select menu
		$("#currencyDiv").html('<?=$currencyDropDown?>');	//re-construct the acct menu
			
		$("select[name=on_condition]").remove();	//remove on_condition select menu
		$("#conditionDiv").html('<?=$conditionDropDown?>');	//re-construct the on_condition men
		
		$("select[name=unit]").remove();	//remove unit select menu
		$("#unitDiv").html('<?=$unitDropDown?>');	//re-construct the unit men
		
		$("select[name=exchange]").remove();	//remove exchange menu
		$("#exchangeDiv").html('<?=$exchangeDropDown?>');	//re-construct the exchange men

		$('select[name=sent]').remove();
		$('#sentDiv').html('<?=$sentDropDown?>');
			
		fillForm(id);
 
				
		$( "#deleteAlert" ).click(function() {
			deleteAlert(id);
		});
		
		$("#conditionTable").dialog({
			modal: true,
			width: 790,
			position: 'top',
			show: {
				effect: "explode",
				duration: 500
			},
			hide: {
				effect: "explode",
				duration: 500
			},
			buttons: {
				Save: function () {
					updateRow(id);
					$( this ).dialog( "close" );
				},
				Cancel: function() {
					refresh();
					$( this ).dialog( "close" );				
				},                        
			}
		});
	
	}
	
	function updateTrade(id) {

		$("select[name=trade_currency]").remove(); //remove  acct select menu
		$("#tradeCurrencyDiv").html('<?=$currencyDropDown?>');	//re-construct the acct menu
			
		$("select[name=trade_condition]").remove();	//remove on_condition select menu
		$("#tradeConditionDiv").html('<?=$conditionDropDown?>');	//re-construct the on_condition men
		
		$("select[name=trade_exchange]").remove();	//remove exchange menu
		$("#tradeExchangeDiv").html('<?=$exchangeDropDown?>');	//re-construct the exchange men

	
		$( "#deleteTrade" ).click(function() {
			deleteTrade(id);
		});
		
				
		$("#tradeTable").dialog({
			modal: true,
			width: 790,
			position: 'top',
			show: {
				effect: "explode",
				duration: 500
			},
			hide: {
				effect: "explode",
				duration: 500
			},
			buttons: {
				Save: function () {
					updateRow(id);
					$( this ).dialog( "close" );
				},
				Cancel: function() {
					refresh();
					$( this ).dialog( "close" );				
				},                        
			}
		});
	
	}

    $(document).ready(function () {
        	
		
			
		//hide pop up forms			
		$("#conditionTable").hide();
		$("#tradeTable").hide();		
			
			
							
        $(".createButton").click(function() {

			$("#conditionTable").dialog({
				modal: true,
				width: 790,
				position: 'top',
				show: {
					effect: "explode",
					duration: 500
				},
				hide: {
					effect: "explode",
					duration: 500
				},
				buttons: {
					Save: function() {
						createRow();
						$(this).dialog("close");
					},
					Cancel: function() {
						$(this).dialog("close");
						
					}
				}
			})
		});
		
		$(".tradeButton").click(function() {
			$("#tradeTable").dialog({
				modal: true,
				width: 790,
				position: 'top',
				show: {
					effect: "explode",
					duration: 500
				},
				hide: {
					effect: "explode",
					duration: 500
				},
				buttons: {
					Save: function() {
						createTrade();
						$(this).dialog("close");
					},
					Cancel: function() {
						$(this).dialog("close");
					}
				}
			})
		});
		
    });

	
</script>