<head>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

<!-- JQueryUI -->
<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css" />

<script src="http://code.jquery.com/jquery-latest.min.js" type='text/javascript' /></script>

<script src="include/jquery-ui/ui/jquery-ui.js"></script>
<style>
    body {
        margin: 5px 20px;
    }
</style>

<script>
		
	function updateRow(id) {
		$.ajax({ //Process the form using $.ajax()
			type        : 'POST', //Method type
			url         : '<?=$update_call?>', //Your form processing file url
			data        : $('#conditionTable').serialize(), 
			success     : function(msg) {
				console.log(msg);
				location.reload();
			}
		});
		event.preventDefault(); //Prevent the default submit      
	}
    
	function fillForm(id) {
		
		$.getJSON("<?=$read_call?>&id="+id+"", function( data ) {
		
		$.each( data, function( key, val ) {
               if(data.hasOwnProperty(key))
                    $('input[name='+key+']').val(val);

               if(key == 'currency') {					
                    $('select[name="currency"]').find('option:contains("'+val+'")').attr("selected",true);	
			}
			
			if(key == 'on_condition') {					
                    $('select[name="on_condition"]').find('option:contains("'+val+'")').attr("selected",true);	
			}
				 
		
            });
        });
    }
    
    function deleteRow(id) {
        if (confirm("Are you sure you want to delete record "+id+"?")) {
            $.ajax({
                type: "GET",
                url: "<?=$delete_call?>&id="+id,
                success: function() {
                    alert('Deleted record '+id);
                    location.reload();
                }
            })
        }    
    }
    
    function createRow() {
		$.ajax({
			type: "POST",
			url: "<?=$create_call?>",
			data: $('#conditionTable').serialize(),
			success: function(msg) {
				console.log(msg);
				//location.reload();
			}
		});
    }
    
	
	function updateDialog(id) {

		$("option:selected").removeAttr("selected");
		
		$('#formTitle').html('Update Account #'+id);
		
		setTimeout(fillForm(id), 1000);
	 
		$("#updateForm").dialog({
			modal: true,
			width: 700,
			position: 'top',
			show: {
				effect: "explode",
				duration: 500
			},
			hide: {
				effect: "explode",
				duration: 500
			},
			buttons: {
				Save: function () {
					updateRow(id);
					$( this ).dialog( "close" );
				},
				Cancel: function() {
					$( this ).dialog( "close" );				
				},                        
			}
		});
	}

    $(document).ready(function () {
        
		$(".updateForm").click(function() {
			
			//Remove the select element and reconstruct it - to prevent from selecting the wrong option
			
			$("select[name=currency]").remove(); //remove  acct select menu
			
			$("select[name=on_condition]").remove();	//remove priority select menu
			
			$("#acctRow").html('<?=$dropDownMenu?>');	//re-construct the acct menu
			
			$("#priorityRow").html('<?=$priDropDownMenu?>');	//re-construct the priority menu
			
		});
		
        $(".createButton").click(function() {
			
			$("#conditionTable").dialog({
				modal: true,
				width: 790,
				position: 'top',
				show: {
					effect: "explode",
					duration: 500
				},
				hide: {
					effect: "explode",
					duration: 500
				},
				buttons: {
					Save: function() {
						createRow();
						$(this).dialog("close");
					},
					Cancel: function() {
						$(this).dialog("close");
					}
				}
			})
			});
		
    });
	
	
</script>
</head>
<body>


<input type="button" class="createButton" value = "Add"/>

<br />
 
 
<div class="container">
	<div class="row justify-content-md-center">
		<div class="col">
			<table class="table">
			<thead class="thead-default">
				<th>Currency Pair</th>
				<th>Price - Poloniex</th>
			 
				</thead>
			<tr>
				<td>ETH/BTC </td>
				<td> <?=$BTC_ETH['last']; ?>
			</td>
			</tr>
				<td>BTC/USDT </td>
				<td> $<?=$USDT_BTC['last'] ?> </td>
			</tr>
			</tr>
				<td>ETH/USDT </td>
				<td> $<?=$USDT_ETH['last']?> </td>
			</tr>
			</table>
			
			<table class="table">
				<thead class="thead-default">
				<th>Currency</th>
				<th>Condition</th>
				<th>Price</th>
				<th>Action</th>
				</thead>
				<tbody>
				
				</tbody>
			</table>
		</div>
    
		<div class="col">
		 
	
			<div id="links_to_charts">
				<h3>Links to Charts</h3>
				<pre class="xdebug-var-dump">
				<table>
					<tr valign="top">
						<td>
							
							<a href="http://coinmarketcap.com/currencies/views/all" target="_blank">Coin Market cap</a>
							<br /><br />
							
							<a href="http://bitcoinwisdom.com/markets/bitfinex/btcusd" target="_blank">Bitcoin Wisdom</a>
							<br /><br />
							
							<a href="https://www.tradingview.com/chart/BTCUSD" target="_blank">TradingView</a>
						</td>
						<td width="18px"></td>
						
					</tr>
					</table>
				</pre>
            </div>
			
			
			
			<div id="coinbase_links">
				<h3>Coinbase Links</h3>
				<pre class="xdebug-var-dump">
				<table class="">
					<tr valign="top">
						<td>
							<a href="https://www.coinbase.com/trade" target="_blank">Buy/Sell Screen</a>
							 
							<br /><br />
							
							<a href="https://www.coinbase.com/accounts" target="_blank">Coinbase Funds</a>
						</td>
					</tr>
				</table>
				</pre>
			</div>
			
			<div id="poloniex_links">
				<h3>Poloniex Links</h3>
				<pre class="xdebug-var-dump">
				<table>
					<tr valign="top">
						<td>
							<a href="https://poloniex.com/balances" target="_blank">Polo Funds</a>
							
							<br /><br />
							
							<a href="https://poloniex.com/login" target="_blank">Polo Login</a>
							
							<br /><br />
											
						</td>
					   
					</tr>
				</table>
            </pre>
		</div>
	
                  
            
		</div>
	</div>

</div>
 



<form id="conditionTable" title="Price Alerts">
    
	<table class="table">
	<thead class="thead-default">
	<tr>
		<th>Currency</th>
		<th>Condition</th>
		<th>Price</th>
		<th>Action</th>
		<th>Exchange</th>
		<th>Delete</th>
	</tr>
	</thead>
	<tr>
		<td>
			<select name="currency">
				<option>BTC/USDT</option>
				<option>ETH/USDT</option>
				<option>ETH/BTC</option>
			</select>
			
			 
		</td>
		<td>
			<select name="on_condition">
				<option><=</option>
				<option>>=</option>
			</select>
		</td>
		<td>
			<input type="text" name="price" size="15" />
		</td>
		<td>
			<select name="action">
				<option>Alert</option>

			</select>
		</td>
		<td>
			<select name="exchange">
				<option>Poloniex</option>
			</select>
		</td>
		<td>
			<input type="button" value = "X">
		</td>
	</tr>
	</table>
	
</form>
</body>