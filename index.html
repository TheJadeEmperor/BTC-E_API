<head>
	<title>BTC API Dashboard</title>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

	<!-- JQueryUI -->
	<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css" />

	<script src="http://code.jquery.com/jquery-latest.min.js" type='text/javascript' /></script>

	<script src="include/jquery-ui/ui/jquery-ui.js"></script>

<style>
    body {
        margin: 5px 20px;
    }
	
	.clickable, .btn {
		cursor: pointer;
	}
	
	.green {
		color: green;
	}
</style>

<?
include('scripts.html');
?>

</head>
<body>
<div class="container">

	<button class = "createButton btn btn-primary">Add Alert</button>
	
	<button class = "tradeButton btn btn-success">Add Trade</button>
	
	<button class = "balanceButton btn btn-danger">View Balance</button>

	<br /><br />
	
	<div class="row justify-content-md-center">
		<div class="col-md-7">
			<table class="table">
				<thead class="thead-default">
					<th>Currency Pair</th>
					<th>Poloniex Price</th>
					<th>BTCe Price</th>
				</thead>
				<tr>
					<td>DASH/USDT </td>
					<td> $<?=$polo_dash_usd ?> </td>
					<td> $<?=$btce_dash_usd ?> </td>
				</tr>
				<tr>
					<td>BTC/USDT </td>
					<td> $<?=$polo_btc_usd ?> </td>
					<td> $<?=$btce_btc_usd ?> </td>
				</tr>
				</tr>
					<td>ETH/USDT </td>
					<td> $<?=$polo_eth_usd ?> </td>
					<td> $<?=$btce_eth_usd ?> </td>
				</tr>
				</tr>
					<td>LTC/USDT </td>
					<td> $<?=$polo_ltc_usd ?> </td>
					<td> $<?=$btce_ltc_usd ?> </td>
				</tr>				
			</table>
			
			
			<table class="table">
				<thead class="thead-default">
				<tr>
					<th colspan="5">btc_alerts Table <a href="cronSendAlerts.php?debug=1" target="_BLANK"><input type="button" value="cronSendAlerts"></a>
					</th>
				</tr>
				<tr>
					<th>Currency</th>
					<th>Condition</th>
					<th>Price</th>
					<th>Exchange</th>
					<th>Sent?</th>
				</tr>
				</thead>
				<tbody>
				<?php
				foreach($condTable as $cond) {
					echo '<tr class="clickable" onclick="javascript:updateAlertDialog(\''.$cond->id.'\')" title="'.$cond->id.'">
					<td>'.$cond->currency.'</td>
					<td>'.$cond->on_condition.'</td>
					<td>'.$cond->price.' '.$cond->unit.'</td>
					<td>'.$cond->exchange.'</td>
					<td>'.$cond->sent.'</td>
				';
				}

				?>
				</tbody>
			</table>
			
		
		</div>
    
		<div class="col">
			<div id="links_to_charts">
				<h3>Links to Charts</h3>
				<pre class="xdebug-var-dump">
				<table>
					<tr valign="top">
						<td>
							<a href="http://coinmarketcap.com/currencies/views/all" target="_blank">Coin Market Cap</a>
							<br /><br />
							
							<a href="https://www.tradingview.com/chart/BTCUSD" target="_blank">TradingView BTC/USD</a>
							<br /><br />
							
							<a href="https://www.tradingview.com/chart/ETHUSD" target="_blank">TradingView ETH/USD</a>
							<br /><br />
							
							<a href="http://bitcoinwisdom.com/markets/bitfinex/btcusd" target="_blank">Bitcoin Wisdom</a>
							
						</td>
						<td width="18px"></td>
					</tr>
					</table>
				</pre>
            </div>
			
			<div id="coinbase_links">
				<h3>Coinbase Links</h3>
				<pre class="xdebug-var-dump">
				<table class="">
					<tr valign="top">
						<td>
							<a href="https://www.coinbase.com/trade" target="_blank">Buy/Sell Screen</a>
							 
							<br /><br />
							
							<a href="https://www.coinbase.com/accounts" target="_blank">Coinbase Funds</a>
							
							<br /><br />
							
							<a href="https://www.gdax.com/" target="_blank">GDAX Exchange</a>
							
						</td>
					</tr>
				</table>
				</pre>
			</div>
			
			<div id="poloniex_links">
				<h3>Poloniex Links</h3>
				<pre class="xdebug-var-dump">
				<table>
					<tr valign="top">
						<td>
							<a href="https://poloniex.com/login" target="_blank">Polo Login</a>
							
							<br /><br />
							
							<a href="https://poloniex.com/balances" target="_blank">Polo Funds</a>
							
							<br /><br />
							
							<a href="https://poloniex.com/exchange" target="_blank">Polo Exchange</a>
							
							<br /><br />
							
							<a href="https://bittrex.com/account/login" target="_blank">Bittrex Exchange</a>
											
						</td>
					   
					</tr>
				</table>
				</pre>
			</div>
			
			
		</div>
	</div>

	<div class="row justify-content-md-center">
		<div class="col-md-7">
		<table class="table">
				<thead class="thead-default">
				<tr>
					<th colspan="6">btc_trades Table <a href="cronSendTrades.php?debug=1" target="_BLANK"><input type="button" value="cronSendTrades"></a>
					</th>
				</tr>
				<tr>
					<th>Currency</th>
					<th>Condition</th>
					<th>Amount</th>
					<th>Valid Until</th>
				</tr>
				</thead>
				<tbody>
				<?php
				foreach($tradesTable as $trade) {
					$trade_amount = number_format($trade->trade_amount, 4);
					
				
					echo '<tr class="clickable" onclick="javascript:updateTradeDialog(\''.$trade->id.'\')" title="id: '.$trade->id.' | trade_until: '.$trade->until_date.' '.$trade->until_time.'">
					<td>'.$trade->trade_currency.'</td>
					<td>'.$trade->trade_condition.' 
					'.$trade->trade_price.' '.$trade->trade_unit.'</td>
					<td>'.$trade->trade_action.' '.$trade_amount.'</td>
					<td>'.$trade->until_format.'</td>
				';
				}

				?>
				</tbody>
				</tr>
			</table>
	</div>
 
	<div class="col">
		<table class="table">
		<thead class="thead-default">
			<tr>
				<th colspan="2">Today's Winners
				<a href="cronAutoTrade.php?debug=1" target="_BLANK"><input type="button" value="cronAutoTrade"></th>
			</tr>
			<tr>
				<th>Currency</th>
				<th>Percent Change</th>
			</tr>
		</thead>
	<?php
	$tickerArray = $polo->get_ticker();
	foreach($tickerArray as $currencyPair => $tickerData) {
		$percentChange = $tickerData['percentChange'];
		
		list($crap, $curr) = explode('_',  $currencyPair);
		
		$percentChangeFormat = $percentChange * 100;
		
		$percentChangeFormat = number_format($percentChangeFormat, 2);
		
		if($crap == 'BTC') //only show BTC markets
		if($percentChangeFormat > 10) {
			echo '<tr>
			<td>'.$currencyPair.'</td>
			<td class="green">+'.$percentChangeFormat.'%</td></tr>';
		}
	}
	?>
	</table>
	</div>
	</div>


</div><!--container-->

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p>

<form id="conditionTable" title="Price Alerts">
    
	<input type="hidden" id="id" name="id" />
	
	<table class="table">
	<thead class="thead-default">
	<tr>
		<th>Currency</th>
		<th>Condition</th>
		<th>Price</th>
		<th>Unit</th>
		<th>Exchange</th>
	</tr>
	</thead>
	<tr>
		<td>
			<input type="text" name="currency" size="10" />
		
			<!--<div id="currencyDiv"><?=$currencyDropDown?></div>	-->
		</td>
		<td>
			<div id="conditionDiv">
			<?=$conditionDropDown?>
			</div>
		</td>
		<td>
			<input type="text" name="price" size="15" />
		</td>
		<td>
			<div id="unitDiv"><?=$unitDropDown?></div>
		</td>
		<td>
			<div id="exchangeDiv"><?=$exchangeDropDown?></div>
		</td>
		
	</tr>
	</table>
	<table>
	<tr>
		<td width="200px">
			Already Sent? <span id="sentDiv"><?=$sentDropDown?></span> 
		</td>
		<td>
			<button id="deleteAlert" class="btn btn-danger">Delete</button>

		</td>
	</tr>
	</table>	
</form>


<form id="tradeTable" title="Active Trades">

	<input type="hidden" id="trade_id" name="trade_id" />

	<table class="table">
	<thead class="thead-default">
	<tr>
		<th>Exchange</th>
		<th>Currency</th>
		<th>Condition</th>
		<th>Price </th>		
		<th>Unit</th>
	</tr>
	</thead>
	<tr>
		<td>
			<div id="tradeExchangeDiv"><?=$tradeExchangeDropDown?></div>
		</td>
		<td>
			<input type="text" name="trade_currency" size="10" />
		</td>
		<td>
			<div id="tradeConditionDiv"><?=$tradeConditionDropDown?></div>
		</td>
		<td>
			<input type="text" name="trade_price" size="10" />	
		</td>
		<td>
			<div id="tradeUnitDiv"><?=$tradeUnitDropDown?></div>
		</td>
	</tr>
	</table>
	
	<table class="table">
	<thead class="thead-default">
	<tr>
		<th>Action</th>
		<th>Amount</th>
		<th>Date Time</th>
		<th>Delete</th>
	</tr>
	</thead>
	<tr>
		<td>
			<div id="tradeActionDiv">
				<?=$tradeActionDropDown?>
			</div>
		</td>
		<td>
			<input type="text" name="trade_amount" size="12" />
		</td>
		<td>
			<input type="text" name="until_date" id="until_date" size="10" />
			<input type="text" name="until_time" id="until_time" size="10" />
		</td>	
		<td>
			<button id="deleteTrade" class="btn btn-danger">Delete</button>
		</td>
	</tr>
	</table>
</form>



<form id="accountBalance" title="Account Balance">
<h2>Poloniex</h2>
<table>
<tr>
	<th>Currency</th><th>Balance</th><th>Price</th><th>Change</th><th>Chart</th>
</tr>
	<?php
	$balanceArray = $polo->get_balances();

	$tickerArray = $polo->get_ticker();
			
	foreach($balanceArray as $currency => $currencyBalance) {
		if($currencyBalance > 0.001) {
		
			foreach($tickerArray as $currencyPair => $tickerData) {
				list($crap, $curr) = explode('_',  $currencyPair);
			
				if($currency == $curr && $crap == 'BTC') {
					$percentChange = $tickerData['percentChange'];
					$lastFormat = $tickerData['last'];
					
					$percentChangeFormat = $percentChange * 100;
					$percentChangeFormat = number_format($percentChangeFormat, 2);
					
					$lastFormat = number_format($lastFormat, 8);
				}	
			}
			
			if($currency == 'BTC') {
				$chartLink = 'BTCUSD';
				$percentChangeFormat = $lastFormat = 0;
			}
			else 
				$chartLink = $currency.'BTC';
			
			if($percentChangeFormat > 0) $color = 'green';
			else $color = 'red';
			
			$balanceTable .= '<tr><td>'.$currency.'</td>
			<td>'.$currencyBalance.'</td>
			<td>'.$lastFormat.'</td>
			<td style="color: '.$color.'">'.$percentChangeFormat.'%</td>
			<td><a href="https://www.tradingview.com/chart/'.$chartLink.'" target="_BLANK">View</a></td>
			</tr>';
		}
	}
	echo $balanceTable;
	?>
<table>
</form>


</body>